# Ralph Progress Log
Started: Mon Jan 19 20:30:13 +08 2026
---

## Codebase Patterns
- Plugin module structure: lua/tiny-cloak/init.lua for main module
- Default config includes file_patterns and cloak_character fields
- Use vim.tbl_deep_extend for merging user config with defaults
- Runtimepath (rtp) must include project root for require() to work

## Mon Jan 19 20:38:00 +08 2026 - US-001
- Implemented setup() function with default configuration
- Created lua/tiny-cloak/init.lua with M.setup() and default_config
- Verified plugin loads without errors with proper rtp configuration
- Ran stylua for formatting and luac for syntax validation
- Files changed: lua/tiny-cloak/init.lua
- **Learnings for future iterations:**
  - Neovim requires rtp+=/path to find lua modules via require()
  - package.path can also be set explicitly: lua/?.lua;lua/?/init.lua
  - Use --headless mode for testing lua code without opening UI
  - selene not installed, but lua-language-server available for typechecking
---
## Mon Jan 19 20:55:00 +08 2026 - US-002
- Implemented core cloaking engine with extmarks
- Added namespace via vim.api.nvim_create_namespace('tiny-cloak')
- Implemented cloak_line(bufnr, line_num, start_col, end_col) function
- Uses nvim_buf_set_extmark with virt_text and virt_text_pos='overlay'
- Cloak character repeats to match original text length
- Verified with headless nvim test: extmark created successfully
- Files changed: lua/tiny-cloak/init.lua
- **Learnings for future iterations:**
  - extmark end_col is exclusive (end_col = start_col + length)
  - nvim_buf_set_extmark validates end_col against line length
  - virt_text with overlay position replaces text visually
  - Use lua-language-server --check for type validation
---

## Mon Jan 19 21:30:00 +08 2026 - US-003
- Implemented .env file cloaking for US-003
- Added pattern matching for API_KEY, SECRET, PASSWORD, TOKEN, CREDENTIAL, AUTH
- Only the value portion is cloaked (key name remains visible)
- Example: API_KEY=sk-abc123 displays as API_KEY=**********
- Files changed: lua/tiny-cloak/init.lua
- **Learnings for future iterations:**
  - Lua patterns use ^ for start of string, not regex ^ anchor
  - Lua string.find uses plain patterns, not full regex (no | alternation)
  - extmark end_col is exclusive and refers to column position, not character index
  - Use details=true in nvim_buf_get_extmarks to get extmark options
